{% extends "base.html" %} {% block title %}Cadastro Candidato{% endblock %} {%
block head %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='formulario.css') }}"
/>
{% endblock %} {% block content %}
<div class="flex items-center justify-center py-10">
  <div
    class="flex w-full max-w-4xl bg-white rounded-xl shadow-lg overflow-hidden"
  >
    <!-- Lado esquerdo: Formulário -->
    <div class="w-1/2 p-8">
      <h2 class="text-3xl font-bold text-[#7C71B2] text-center mb-4">
        Criar Conta
      </h2>

      <form id="registerForm" class="space-y-4">
        <input
          type="text"
          id="nome"
          name="nome"
          placeholder="Nome completo"
          required
          class="w-full px-4 py-2 rounded-full bg-[#E1D8EB] placeholder-[#7C71B2] text-sm focus:outline-none"
        />

        <input
          type="email"
          id="email"
          name="email"
          placeholder="E-mail"
          required
          class="w-full px-4 py-2 rounded-full bg-[#E1D8EB] placeholder-[#7C71B2] text-sm focus:outline-none"
        />

        <input
          type="tel"
          name="telefone"
          placeholder="telefone"
          maxlength="11"
          required
          aria-required="true"
          class="w-full px-4 py-2 rounded-full bg-[#E1D8EB] placeholder-[#7C71B2] text-sm focus:outline-none"
        />

        <input
          type="url"
          id="linkedin"
          name="linkedin"
          placeholder="LinkedIn"
          required
          class="w-full px-4 py-2 rounded-full bg-[#E1D8EB] placeholder-[#7C71B2] text-sm focus:outline-none"
        />

        <div class="relative">
          <input
            type="text"
            id="endereco_completo"
            name="endereco_completo"
            placeholder="Endereço completo (Ex: Rua das Flores, 123, São Paulo, SP)"
            required
            class="w-full px-4 py-2 rounded-full bg-[#E1D8EB] placeholder-[#7C71B2] text-sm focus:outline-none"
            oninput="validarEndereco(this)"
          />
          <div id="endereco_feedback" class="mt-1 text-xs text-red-500 hidden"></div>
          <div id="endereco_sugestoes" class="mt-1 text-xs text-blue-600 hidden"></div>
        </div>

        <input
          type="number"
          id="pretensao_salarial"
          name="pretensao_salarial"
          placeholder="Pretensão Salarial (R$)"
          step="0.01"
          required
          class="w-full px-4 py-2 rounded-full bg-[#E1D8EB] placeholder-[#7C71B2] text-sm focus:outline-none"
        />

        <input
          type="password"
          id="senha"
          name="senha"
          placeholder="Senha"
          required
          class="w-full px-4 py-2 rounded-full bg-[#E1D8EB] placeholder-[#7C71B2] text-sm focus:outline-none"
        />

        <input
          type="password"
          id="confirmar_senha"
          name="confirmar_senha"
          placeholder="Confirmar Senha"
          required
          class="w-full px-4 py-2 rounded-full bg-[#E1D8EB] placeholder-[#7C71B2] text-sm focus:outline-none"
        />

        <div class="mb-6">
                    <label class="flex items-start space-x-3">
                        <input type="checkbox" name="aceita_termos" required class="mt-1 h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded">
                        <span class="text-sm text-gray-600">
                            Eu concordo com os <a href="{{ url_for('politica_privacidade') }}" target="_blank" class="text-purple-600 hover:underline">termos de uso e política de privacidade</a>. 
                            Entendo que meus dados serão utilizados para conectar-me com oportunidades de trabalho relevantes e que posso retirar meu consentimento a qualquer momento.
                        </span>
                    </label>
                </div>

                <button
          type="submit"
          class="w-full bg-[#7C71B2] hover:bg-purple-600 text-white font-bold py-2 rounded-full transition"
        >
          Cadastrar
        </button>
      </form>
    </div>

    <!-- Lado direito -->
    <div
      class="w-1/2 bg-[#7C71B2] text-white p-8 flex flex-col justify-center items-center rounded-l-[4rem]"
    >
      <h1 class="text-4xl font-bold mb-4">Bem-Vindo de Volta!</h1>
      <p class="mb-6 text-sm">Já possui uma conta? Faça seu login abaixo</p>
      <a
        href="{{ url_for('login_candidato') }}"
        class="bg-white text-[#7C71B2] px-6 py-2 rounded-full font-bold hover:bg-gray-100 transition"
      >
        Login
      </a>
      <a
        href="{{ url_for('cadastro_empresa') }}"
        class="mt-4 text-sm text-white underline hover:text-[#E1D8EB] transition-colors duration-200"
      >
        Sou empresa
      </a>
    </div>
  </div>
</div>

<!-- Script de envio -->
<script>
  const form = document.getElementById("registerForm");

  // Função para validar endereço em tempo real
  function validarEndereco(input) {
    const endereco = input.value.trim();
    const feedbackDiv = document.getElementById('endereco_feedback');
    const sugestoesDiv = document.getElementById('endereco_sugestoes');

    // Limpar mensagens anteriores
    feedbackDiv.classList.add('hidden');
    sugestoesDiv.classList.add('hidden');

    if (endereco.length < 10) {
      feedbackDiv.textContent = 'Endereço muito curto. Inclua rua, número, cidade e estado.';
      feedbackDiv.classList.remove('hidden');
      return false;
    }

    if (!endereco.includes(',') && !endereco.includes('-')) {
      feedbackDiv.textContent = 'Use vírgulas ou hífens para separar as partes do endereço.';
      feedbackDiv.classList.remove('hidden');
      return false;
    }

    if (endereco.split(' ').length < 3) {
      feedbackDiv.textContent = 'Adicione mais detalhes ao endereço.';
      feedbackDiv.classList.remove('hidden');
      return false;
    }

    // Verificar se tem cidade e estado
    const temCidade = /[,\-]\s*[A-Za-z\s]+/.test(endereco);
    const temEstado = /[,\-]\s*[A-Z]{2}$|[,\-]\s*[A-Za-z\s]+$/.test(endereco);

    if (!temCidade || !temEstado) {
      sugestoesDiv.textContent = 'Dica: Inclua cidade e estado (ex: São Paulo, SP)';
      sugestoesDiv.classList.remove('hidden');
    }

    return true;
  }

  form.addEventListener("submit", async (event) => {
    event.preventDefault();

    // Validar endereço antes de enviar
    const enderecoInput = document.getElementById('endereco_completo');
    if (!validarEndereco(enderecoInput)) {
      alert('Por favor, corrija o endereço antes de continuar.');
      return;
    }

    const formData = new FormData(form);
    let data = Object.fromEntries(formData.entries());
    data.pretensao_salarial = parseFloat(data.pretensao_salarial);

    if (data.senha !== data.confirmar_senha) {
      alert("As senhas não coincidem!");
      return;
    }

    try {
      const response = await fetch("{{ url_for('cadastro_candidato') }}", {
        method: "POST",
        body: formData
      });

      if (response.ok) {
        alert("Cadastro realizado com sucesso!");
        window.location.href = "{{ url_for('login_candidato') }}";
      } else {
        const text = await response.text();
        alert("Erro ao cadastrar. Verifique os dados.");
      }
    } catch (error) {
      console.error(error);
      alert("Erro ao se conectar com o servidor!");
    }
  });
</script>
{% endblock %}